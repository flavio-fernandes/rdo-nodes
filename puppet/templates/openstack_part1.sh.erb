#!/usr/bin/env bash
set -e

source /root/keystonerc_admin

glance image-create \
  --copy-from http://download.cirros-cloud.net/0.3.1/cirros-0.3.1-x86_64-disk.img \
  --is-public true \
  --container-format bare \
  --disk-format qcow2 \
  --name cirros

nova flavor-create m1.nano auto 128 1 1

keystone tenant-create --name=tenant1 --enabled=true
keystone user-create --name=user1 --pass=user1 --email=user1@example.com 
keystone user-role-add --user=user1 --role=_member_ --tenant=tenant1

keystone tenant-create --name=tenant2 --enabled=true
keystone user-create --name=user2 --pass=user2 --email=user2@example.com 
keystone user-role-add --user=user2 --role=_member_ --tenant=tenant2

## NOTE: physnetext2 --> must match what we used at answers.txt
neutron net-create ext1 --router:external=True \
   --tenant_id=$(keystone tenant-list | grep tenant1 | awk '{print $2}') \
   --provider:network_type flat \
   --provider:physical_network physnetext2

neutron subnet-create --allocation-pool start=192.168.111.20,end=192.168.111.99 --gateway=192.168.111.254 \
   --disable-dhcp --name subext1 ext1 192.168.111.0/24

## NOTE: physnetext3 --> must match what we used at answers.txt
neutron net-create ext2 --router:external=True \
   --tenant_id=$(keystone tenant-list | grep tenant2 | awk '{print $2}') \
   --provider:network_type flat \
   --provider:physical_network physnetext3

neutron subnet-create --allocation-pool start=192.168.112.20,end=192.168.112.99 --gateway=192.168.112.254 \
   --disable-dhcp --name subext2 ext2 192.168.112.0/24

